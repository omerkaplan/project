Status: published
Title:  Pelican changelog v.1.01: We have dark mode! 
Date:   2025-07-20 8:30:00 -0400
Category: project
Projecttype: Python, Pelican
Tags: chess, something
Summary: This is a summary of the post so I can see it on the homepage  
social_image: imagefile

Designing a static site with a clean, modern look has always been a goal of mine ‚Äî but in 2025, one feature feels almost mandatory: **dark mode**.

While Pelican doesn‚Äôt come with dark mode out of the box, it‚Äôs flexible enough to support it. This post documents how I added theme switching to my personal site, the gotchas I hit along the way, and the final architecture that keeps everything tidy.

---

### üåí Step 1: Choose a CSS Strategy

My project already had a `custom.scss` file (converted to `custom.css` via a Sass build step). That made it easy to layer in a dark theme using CSS variables.

We started by defining **base variables** in `:root` for light mode:

```scss
:root {
  --bg: #fdfdfd;
  --text: #202124;
  --accent-purple: #a277ff;
  --accent-orange: #ffca85;
  --accent-green: #61ffca;
}
```

Then we added an alternate theme using a `[data-theme="dark"]` attribute:

```scss
[data-theme="dark"] {
  --bg: #1e1e1e;
  --text: #c9d1d9;
  --accent-purple: #c792ea;
  --accent-orange: #ffcb6b;
  --accent-green: #c3e88d;
}
```

This approach makes it dead simple to toggle themes ‚Äî all you need to do is add or remove the `data-theme="dark"` attribute on the `<html>` element.

---

### üß† Step 2: Decide Where and How to Toggle

To keep things clean and unobtrusive, we split the JavaScript into two parts:

1. **Early script (in `<head>`)**: Checks the user‚Äôs saved preference or system setting and applies dark mode *before* the page renders, to avoid a ‚Äúflash of white.‚Äù
2. **Interactive script (in `<body>`)**: Handles the toggle button behavior after the DOM loads.

Here‚Äôs a simplified version of the early script:

```js
if (!localStorage.getItem("theme")) {
  if (window.matchMedia("(prefers-color-scheme: dark)").matches) {
    document.documentElement.setAttribute("data-theme", "dark");
  }
} else if (localStorage.getItem("theme") === "dark") {
  document.documentElement.setAttribute("data-theme", "dark");
}
```

And the interactive script:

```js
document.addEventListener("DOMContentLoaded", function () {
  const toggle = document.getElementById("theme-toggle");
  toggle.addEventListener("click", () => {
    const isDark = document.documentElement.getAttribute("data-theme") === "dark";
    if (isDark) {
      document.documentElement.removeAttribute("data-theme");
      localStorage.setItem("theme", "light");
    } else {
      document.documentElement.setAttribute("data-theme", "dark");
      localStorage.setItem("theme", "dark");
    }
  });
});
```

We later moved this code into a dedicated `theme.js` file, placed it in the content directory, and used Pelican‚Äôs `STATIC_PATHS` setting to make sure it was copied correctly.

---

### ‚ö†Ô∏è Gotchas and Debugging

Several small things tripped us up along the way:

- **Pelican doesn‚Äôt auto-copy static JS or CSS files** unless you explicitly include them in `STATIC_PATHS`. Double-check that your theme or content folder handles this properly.
- **Running multiple `pelican --listen` instances** caused bizarre bugs, from broken routing to infinite rebuilds. Be sure to kill old processes (`lsof -i :8000` is your friend).
- **Placing JS in `<head>`** is fine, but be sure to split logic between "early theming" and "event handling" to avoid race conditions with the DOM.

---

### ‚ú® Bonus Touches

Once it was working, we added subtle polish:

- **Smooth transitions** when switching themes via `transition: background-color 0.3s ease, color 0.3s ease;`
- **Keyboard shortcuts** (`Shift+D` to toggle)
- **Custom hover effects** for navbar links, varying by category (e.g. `/projects` in red, `/about-me` in blue)

---

### ‚úÖ Final Thoughts

Implementing dark mode wasn‚Äôt just a cosmetic change ‚Äî it made me rethink my site‚Äôs design from a systems perspective. Using CSS variables, minimal JavaScript, and a clear separation of responsibilities made the codebase cleaner and easier to maintain.

It‚Äôs one of those small features that adds polish, and now I get a little joy every time I toggle that theme switch üòé





